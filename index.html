<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini site</title>

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 32px; }

    .box {
      max-width: 520px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 16px;
      position: relative;
      z-index: 1;
      background: white;
    }

    input#answer {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      border: 2px solid #bbb;
      border-radius: 12px;
      outline: none;
      box-sizing: border-box;
      transition: border-color 150ms, box-shadow 150ms;
    }

    .ok input#answer { border-color: #1a7f37; box-shadow: 0 0 18px rgba(26,127,55,.35); }
    .bad input#answer { border-color: #d1242f; box-shadow: 0 0 18px rgba(209,36,47,.25); }

    .msg { margin-top: 14px; font-size: 18px; min-height: 26px; }
    .hint { margin-top: 10px; font-size: 14px; color: #666; }

    #fx { position: fixed; inset: 0; pointer-events: none; z-index: 9998; display: none; }
    #confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 9999; display: none; }

    .confetto {
      position: absolute;
      top: -12px;
      width: 10px;
      height: 14px;
      opacity: 0.95;
      animation-name: confettiFall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }

    @keyframes confettiFall {
      to { transform: translateY(110vh) rotate(540deg); opacity: 0.25; }
    }

    .winCard {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.92);
      opacity: 0;
      pointer-events: none;
      z-index: 10000;
      transition: 220ms ease;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 18px;
      padding: 12px;
      max-width: min(420px, 84vw);
      box-shadow: 0 18px 60px rgba(0,0,0,0.22);
    }
    .winCard.show {
  pointer-events: auto;
}

    .winCard.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    .winCard img { display: block; width: 100%; height: auto; border-radius: 14px; }

    .winText {
      margin: 14px 6px 4px;
      font-size: 18px;
      line-height: 1.4;
      text-align: center;
      color: #111;
    }

    #leaderboard { margin-top: 16px; padding-left: 20px; font-size: 16px; }
    #leaderboard li { margin-bottom: 6px; }

    /* Modal (popup prÃ©nom) */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20000;
    }
    .modal.hidden { display: none; }

    .modal-box {
      background: white;
      padding: 20px;
      border-radius: 14px;
      width: min(320px, 90%);
      text-align: center;
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
    }

    .modal-box input {
      width: 100%;
      padding: 10px;
      margin-top: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 16px;
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 14px;
    }

    .modal-actions button {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 15px;
    }

    #confirmBtn { background: #22c55e; color: white; }
    #skipBtn { background: #e5e7eb; }

    /* Croix pour fermer la winCard */
    .close-win {
      position: absolute;
      top: 8px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      color: #444;
      line-height: 1;
    }
    .close-win:hover { color: #000; }
    .show-solutions-btn {
  margin-top: 10px;
  width: 100%;
  padding: 12px 12px;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 650;
  background: #111;
  color: #fff;
}

.show-solutions-btn:hover {
  filter: brightness(1.05);
}

.solutions.hidden {
  display: none;
}

.solutions {
  max-width: 820px;
  margin: 22px auto 0;
  padding: 14px;
  border: 1px solid #e5e7eb;
  border-radius: 18px;
  background: #fff;
}

.solutionsHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.solutionsHeader h2 {
  margin: 0;
  font-size: 18px;
}

.solutionsActions {
  display: flex;
  gap: 8px;
}

.solutionsActions button {
  padding: 9px 10px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  background: #f8fafc;
  cursor: pointer;
  font-size: 14px;
}

.solItem {
  border: 1px solid #eef0f3;
  border-radius: 14px;
  margin: 10px 0;
  overflow: hidden;
  background: #fafafa;
}

.solItem summary {
  cursor: pointer;
  padding: 12px 14px;
  font-weight: 700;
  list-style: none;
}

.solItem summary::-webkit-details-marker { display: none; }

.solItem summary::after {
  content: "â–¾";
  float: right;
  transition: transform 160ms ease;
}

.solItem[open] summary::after { transform: rotate(180deg); }

.solContent {
  padding: 12px 14px 14px;
  background: #fff;
  border-top: 1px solid #eef0f3;
  line-height: 1.6;
  font-size: 16px;
}

.solContent p { margin: 0 0 10px; }
.solContent p:last-child { margin-bottom: 0; }

@media (max-width: 480px) {
  .solutions { padding: 12px; border-radius: 16px; }
  .solContent { font-size: 15px; }
  .show-solutions-btn { font-size: 15px; }
}
.winOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
}

.winOverlay.hidden {
  display: none;
}

  </style>
</head>

<body>
  <h1>Entre la rÃ©ponse</h1>

  <div class="box" id="wrap">
    <input
      id="answer"
      type="text"
      placeholder="Tape ta rÃ©ponse puis appuie sur ENTER"
      autocomplete="off"
    />
    <div class="msg" id="msg"></div>
    <div class="hint">Validation uniquement avec la touche ENTER</div>
  </div>

  <h2>Ils ont trouvÃ© ðŸ‘‡</h2>
  <ol id="leaderboard"></ol>

  <canvas id="fx"></canvas>
  <div id="confetti"></div>
 
<div id="winOverlay" class="winOverlay hidden">
  <div id="winCard" class="winCard" aria-hidden="true">
    <button id="closeWinCard" class="close-win" aria-label="Fermer">Ã—</button>
    <img id="winImg" alt="Bravo" />
    <p class="winText">Un prÃ©nom est rÃ©vÃ©lÃ©. Une autre Ã©toile reste Ã  nommer.</p>
    <button id="showSolutionsBtn" class="show-solutions-btn" type="button">
  DÃ©couvrir les rÃ©ponses aux Ã©nigmes
</button>
  </div>
</div>

  
  <section id="solutions" class="solutions hidden" aria-label="RÃ©ponses aux Ã©nigmes">
  <div class="solutionsHeader">
    <h2>ðŸ“œ RÃ©ponses aux Ã©nigmes</h2>
    <div class="solutionsActions">
      <button id="openAllSolutions" type="button">Tout ouvrir</button>
      <button id="closeAllSolutions" type="button">Tout fermer</button>
    </div>
  </div>

  <details class="solItem">
    <summary>Ã‰nigme 1 â€” Carte postale / Bergame / Bergamesque</summary>
    <div class="solContent">
      <p>
        Recto de la carte postale : Il sâ€™agit dâ€™une cÃ©lÃ¨bre place de Bergame, ville dâ€™Italie,
        dont Diane Tell parle dans sa chanson Â« Si jâ€™Ã©tais un homme Â».
        Câ€™est Ã©galement un lien avec la musique Â« Clair de Lune Â» de Debussy puisque ce morceau
        est le troisiÃ¨me mouvement de la suite Bergamesque.
      </p>
      <p>
        Sur le clochÃ© de la place, on trouve un QR Code qui amÃ¨ne vers une vidÃ©o dâ€™un dessin de
        montre affichant un autre lien sous le chiffre 12 et bientÃ´t 16:05 heure du lancement du
        concours Ã©questre Â« Le Grand Prix de Diane Â».
      </p>
      <p>
        La montre est Ã©galement un clin dâ€™oeil Ã  Longines, marque de montre et partenaire historique
        de cet Ã©vÃ©nement. Le lien se situant sous le 12 amÃ¨ne Ã  une vidÃ©o qui correspond au
        rassemblement Chantilly Arts & Ã‰lÃ©gance qui se tient (comme son nom lâ€™indique) Ã  Chantilly,
        lieu oÃ¹ se tient Ã©galement le Grand Prix de Diane.
      </p>
    </div>
  </details>

  <details class="solItem">
    <summary>Ã‰nigme 2 â€” Acrostiche / M-5 / Clair de Lune</summary>
    <div class="solContent">
      <p>
        Lâ€™Ã©nigme en noir est une acrostiche. Il faut prendre les premiers caractÃ¨res de chaque dÃ©but
        de phrase. La mention M-5 correspond au moment oÃ¹ chacun a reÃ§u sa carte postale et un
        dÃ©compte avant la naissance, câ€™est aussi la clÃ© pour dÃ©chiffrer cette acrostiche puisque en
        soustrayant 5 Ã  chaque caractÃ¨re, on obtient la partie manquante du lien internet Ã©crit Ã 
        la verticale Ã  cotÃ© du texte.
      </p>
      <p>
        Ce lien amÃ¨ne Ã  la musique Â« Clair de Lune Â» de Debussy. Ce morceau fait rÃ©fÃ©rence Ã  la Lune
        dont Artemis (autre nom pour Diane) est la dÃ©esse.
      </p>
    </div>
  </details>

  <details class="solItem">
    <summary>Ã‰nigme 3 â€” Timbre / CervidÃ©</summary>
    <div class="solContent">
      <p>
        Le timbre est une image de cervidÃ©, Diane Ã©tant la reprÃ©sentation de la dÃ©esse de la chasse.
      </p>
    </div>
  </details>

  <details class="solItem">
    <summary>Ã‰nigme 4 â€” Apollo / Mer de la TranquillitÃ© / OcÃ©an des TempÃªtes</summary>
    <div class="solContent">
      <p>
        Lâ€™Ã©nigme Ã©crite en verte fait rÃ©fÃ©rence aux missions Apollo, le lieu dâ€™alunissage de Apollo 11
        Ã©tait la mer de la tranquillitÃ© et lâ€™ocÃ©an des tempÃªtes pour Apollo 12.
        Autre rÃ©fÃ©rence Ã  la Lune et aux futures missions Artemis et du retour de lâ€™humain sur la Lune.
      </p>
    </div>
  </details>

  <details class="solItem">
    <summary>Ã‰nigme 5 â€” ChaÃ®ne YouTube / Luminae-X0</summary>
    <div class="solContent">
      <p>
        La chaine YouTube comporte deux indices, le nom Â« Luminae-X0 Â»; Luminae Ã©voque la lumiÃ¨re et
        donc la naissance et Â« ae Â» est un ancien pluriel fÃ©minin.
        X0 correspond Ã  X (le chromosome fÃ©minin) et 0 au dÃ©but de tout donc Ã  la naissance.
      </p>
      <p>
        La photo de profil de la chaine YouTube est une signe fÃ©minin ancestral.
      </p>
    </div>
  </details>
</section>


  <!-- POPUP PRENOM -->
  <div id="nameModal" class="modal hidden">
    <div class="modal-box">
      <p>Bravo ðŸŽ‰ Quel est ton prÃ©nom ?</p>
      <input
        id="playerNameInput"
        type="text"
        placeholder="Entre ton prÃ©nom"
        maxlength="30"
      />
      <div class="modal-actions">
        <button id="skipBtn" type="button">Passer</button>
        <button id="confirmBtn" type="button">Valider</button>
      </div>
    </div>
  </div>

  <!-- SCRIPT PRINCIPAL (jeu + modal) -->
  <script>
    const SECRET = "DIANE";
    const WIN_IMAGE_SRC = "img/etoiles.jpg";

    const wrap = document.getElementById("wrap");
    const input = document.getElementById("answer");
    const msg = document.getElementById("msg");

    const fxCanvas = document.getElementById("fx");
    const fxCtx = fxCanvas.getContext("2d");
    const confettiLayer = document.getElementById("confetti");
    const winOverlay = document.getElementById("winOverlay");
const winCard = document.getElementById("winCard");
    const winImg = document.getElementById("winImg");
    // --- Solutions ---
const solutionsSection = document.getElementById("solutions");
const showSolutionsBtn = document.getElementById("showSolutionsBtn");
const openAllBtn = document.getElementById("openAllSolutions");
const closeAllBtn = document.getElementById("closeAllSolutions");

function revealSolutions() {
  if (!solutionsSection) return;
  solutionsSection.classList.remove("hidden");
  solutionsSection.scrollIntoView({ behavior: "smooth", block: "start" });
}

showSolutionsBtn.addEventListener("click", revealSolutions);

openAllBtn.addEventListener("click", () => {
  solutionsSection.querySelectorAll("details.solItem").forEach(d => d.open = true);
});

closeAllBtn.addEventListener("click", () => {
  solutionsSection.querySelectorAll("details.solItem").forEach(d => d.open = false);
});


    // Croix de fermeture winCard (âš ï¸ NE PAS redÃ©clarer winCard)
    const closeWinBtn = document.getElementById("closeWinCard");
   // âœ… fermer en cliquant n'importe oÃ¹ en dehors de la carte
winOverlay.addEventListener("click", (e) => {
  // seulement si on clique le fond (pas sur l'image, pas sur les boutons)
  if (e.target === winOverlay) {
    resetWinExperience();
  }
});


    // Modal elements
    const modal = document.getElementById("nameModal");
    const nameInput = document.getElementById("playerNameInput");
    const confirmBtn = document.getElementById("confirmBtn");
    const skipBtn = document.getElementById("skipBtn");

    let solved = false;
    let nameAsked = false;

    function openNameModal() {
      nameInput.value = "";
      modal.classList.remove("hidden");
      nameInput.focus();
    }

    function closeNameModal() {
      modal.classList.add("hidden");
    }

    confirmBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      if (name && window.__addWinner) window.__addWinner(name);
      closeNameModal();
      input.focus();
    });

    skipBtn.addEventListener("click", () => {
      closeNameModal();
      input.focus();
    });

    // Enter dans le champ prÃ©nom = valider
    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        confirmBtn.click();
      }
    });

    function resizeFx() {
      fxCanvas.width = window.innerWidth;
      fxCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeFx);
    resizeFx();

    function normalize(text) {
      return (text || "").trim().toUpperCase();
    }

    function resetState() {
      wrap.classList.remove("ok", "bad");
      msg.textContent = "";
    }

    const failureMessages = [
      "Pas encore, mais tu peux rÃ©essayer ðŸ™‚",
      "Ce nâ€™est pas la bonne rÃ©ponse, continue !",
      "Presqueâ€¦ enfin pas encore ðŸ˜‰",
      "RatÃ© cette fois, mais ne lÃ¢che pas.",
      "Ce nâ€™est pas Ã§a, essaie autrement.",
      "Mauvaise rÃ©ponse, mais tu es sur la bonne voie.",
      "Non, mais rien nâ€™est perdu !",
      "Ce nâ€™est pas correct pour lâ€™instant.",
      "Pas exactement, retente ta chance.",
      "Dommageâ€¦ mais la solution existe ðŸ˜‰"
    ];

    function randomFailureMessage() {
      return failureMessages[Math.floor(Math.random() * failureMessages.length)];
    }

    function showWinCard() {
  winImg.src = WIN_IMAGE_SRC;

  // âœ… afficher le fond cliquable + la carte
  winOverlay.classList.remove("hidden");
  winCard.classList.add("show");
  winCard.setAttribute("aria-hidden", "false");
}


    function launchConfetti(durationMs = 3600) {
      confettiLayer.innerHTML = "";
      confettiLayer.style.display = "block";

      const colors = ["#22c55e", "#16a34a", "#f97316", "#eab308", "#3b82f6", "#a855f7", "#ef4444"];
      const start = Date.now();

      function spawnBatch() {
        if (Date.now() - start > durationMs) {
          setTimeout(() => {
            confettiLayer.style.display = "none";
            confettiLayer.innerHTML = "";
          }, 1200);
          return;
        }

        for (let i = 0; i < 14; i++) {
          const c = document.createElement("div");
          c.className = "confetto";
          const size = 6 + Math.random() * 10;
          c.style.width = size + "px";
          c.style.height = size * 1.4 + "px";
          c.style.left = Math.random() * 100 + "vw";
          c.style.background = colors[Math.floor(Math.random() * colors.length)];
          c.style.animationDuration = 1100 + Math.random() * 1700 + "ms";
          c.style.animationDelay = Math.random() * 120 + "ms";
          confettiLayer.appendChild(c);
          setTimeout(() => c.remove(), 2200);
        }

        requestAnimationFrame(spawnBatch);
      }

      requestAnimationFrame(spawnBatch);
    }

    function launchFireworks(durationMs = 3200) {
      fxCanvas.style.display = "block";
      const particles = [];
      const start = performance.now();

      function rand(a, b) { return a + Math.random() * (b - a); }

      function burst() {
        const x = rand(fxCanvas.width * 0.15, fxCanvas.width * 0.85);
        const y = rand(fxCanvas.height * 0.12, fxCanvas.height * 0.45);
        for (let i = 0; i < 60; i++) {
          particles.push({
            x, y,
            vx: Math.cos(Math.random() * Math.PI * 2) * rand(2, 6),
            vy: Math.sin(Math.random() * Math.PI * 2) * rand(2, 6),
            life: 60,
            size: rand(1.2, 2.6),
            h: Math.random() * 360
          });
        }
      }

      let last = 0;

      function tick(t) {
        const elapsed = t - start;
        fxCtx.fillStyle = "rgba(0,0,0,0.18)";
        fxCtx.fillRect(0, 0, fxCanvas.width, fxCanvas.height);

        if (elapsed < durationMs && t - last > 200) {
          burst();
          last = t;
        }

        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.06;
          p.life--;

          fxCtx.fillStyle = `hsla(${p.h},95%,60%,${p.life / 60})`;
          fxCtx.beginPath();
          fxCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          fxCtx.fill();

          if (p.life <= 0) particles.splice(i, 1);
        }

        if (elapsed > durationMs && particles.length === 0) {
          fxCanvas.style.display = "none";
          fxCtx.clearRect(0, 0, fxCanvas.width, fxCanvas.height);
          return;
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    }

    function resetWinExperience() {
  // autoriser une nouvelle victoire
  solved = false;
  nameAsked = false;

 // remettre la carte + cacher l'overlay
winCard.classList.remove("show");
winCard.setAttribute("aria-hidden", "true");
winOverlay.classList.add("hidden");

  // nettoyer les effets
  confettiLayer.style.display = "none";
  confettiLayer.innerHTML = "";

  fxCanvas.style.display = "none";
  fxCtx.clearRect(0, 0, fxCanvas.width, fxCanvas.height);

  // enlever l'Ã©tat vert/rouge + message
  wrap.classList.remove("ok", "bad");
  msg.textContent = "";

  // remettre le champ prÃªt
  input.value = "";
  input.focus();
}


    function celebrateWin() {
      launchFireworks(3200);
      launchConfetti(3600);
      setTimeout(showWinCard, 3600);

      // Afficher le popup immÃ©diatement aprÃ¨s la rÃ©ussite (une seule fois)
      if (!nameAsked) {
        nameAsked = true;
        openNameModal();
      }
    }

    function checkAnswer() {
      const value = normalize(input.value);
      if (!value) return;

      if (value === normalize(SECRET)) {
        if (solved) return;
        solved = true;

        wrap.classList.remove("bad");
        wrap.classList.add("ok");
        msg.textContent = "ðŸŽ‰ Bravo, tu as trouvÃ© la bonne rÃ©ponse !";

        celebrateWin();
      } else {
        wrap.classList.remove("ok");
        wrap.classList.add("bad");
        msg.textContent = randomFailureMessage();
      }
    }

    // âœ… ENTER fiabilisÃ©
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkAnswer();
        return;
      }
      if (!solved) resetState();
    });

    input.focus();
  </script>

  <!-- SCRIPT FIREBASE (module) EN DERNIER -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy,
      limit,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCyTkLaV66fWGgzEipwUmTGA1ztE5qM9t4",
      authDomain: "enigmes-prenom.firebaseapp.com",
      projectId: "enigmes-prenom",
      storageBucket: "enigmes-prenom.firebasestorage.app",
      messagingSenderId: "601585511460",
      appId: "1:601585511460:web:29bc1ce97113c934f83cb1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const leaderboard = document.getElementById("leaderboard");

    function render(list) {
      if (!leaderboard) return;
      leaderboard.innerHTML = "";
      list.forEach(item => {
        const li = document.createElement("li");
        const d = item.foundAt?.toDate?.();
        li.textContent = `${item.name} â€” ${d ? d.toLocaleString("fr-FR") : ""}`;
        leaderboard.appendChild(li);
      });
    }

    async function loadWinners() {
      const q = query(
        collection(db, "winners"),
        orderBy("foundAt", "desc"),
        limit(13)
      );
      const snap = await getDocs(q);
      render(snap.docs.map(doc => doc.data()));
    }

    async function addWinner(name) {
      const clean = (name || "").trim().slice(0, 30);
      if (!clean) return;

      await addDoc(collection(db, "winners"), {
        name: clean,
        foundAt: serverTimestamp()
      });

      await loadWinners();
    }

    window.__addWinner = addWinner;
    loadWinners();
  </script>
</body>
</html>
